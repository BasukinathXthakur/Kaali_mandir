import{c as A,d as M,q as T,o as P,g as R,j as e,a as f,n as B,p as q,r as z,s as O,F as U}from"./index-B3Xy1xuM.js";import{r as n}from"./vendor-Cc1FqKl_.js";import"./ui-LFaGVoCt.js";const V=()=>{const[h,y]=n.useState([]),[x,p]=n.useState([]),[N,u]=n.useState(0),[b,g]=n.useState(!0),[m,v]=n.useState(""),[c,w]=n.useState("all"),[o,D]=n.useState("date-desc");n.useEffect(()=>{S()},[]);const S=async()=>{try{const t=A(M,"donations"),d=T(t,P("timestamp","desc")),a=await R(d),s=[];let i=0;a.forEach(r=>{const l={id:r.id,...r.data(),timestamp:r.data().timestamp?.toDate()||new Date};s.push(l),i+=Number(l.amount)}),y(s),p(s),u(i),g(!1)}catch(t){console.error("Error fetching donations:",t),g(!1)}};n.useEffect(()=>{let t=[...h];if(c!=="all"){const a=new Date;let s=new Date;c==="today"?s.setHours(0,0,0,0):c==="week"?s.setDate(a.getDate()-7):c==="month"?s.setMonth(a.getMonth()-1):c==="year"&&s.setFullYear(a.getFullYear()-1),t=t.filter(i=>i.timestamp>=s)}if(m){const a=m.toLowerCase();t=t.filter(s=>s.name?.toLowerCase().includes(a)||s.email?.toLowerCase().includes(a)||s.phone?.includes(a)||s.purpose?.toLowerCase().includes(a))}o==="date-desc"?t.sort((a,s)=>s.timestamp-a.timestamp):o==="date-asc"?t.sort((a,s)=>a.timestamp-s.timestamp):o==="amount-desc"?t.sort((a,s)=>Number(s.amount)-Number(a.amount)):o==="amount-asc"&&t.sort((a,s)=>Number(a.amount)-Number(s.amount)),p(t);const d=t.reduce((a,s)=>a+Number(s.amount),0);u(d)},[h,m,c,o]);const C=t=>{v(t.target.value)},F=t=>{w(t.target.value)},L=t=>{D(t.target.value)},j=t=>t instanceof Date?t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Invalid date",k=()=>{const t=["Name","Email","Phone","Amount","Purpose","Payment Method","Date","Message"],d=x.map(l=>[l.name,l.email,l.phone,l.amount,l.purpose,l.paymentMethod,j(l.timestamp),l.message]),a=[t.join(","),...d.map(l=>l.map(E=>`"${E||""}"`).join(","))].join(`
`),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),r=document.createElement("a");r.setAttribute("href",i),r.setAttribute("download",`donations_${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)};return b?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-xl",children:"Loading donations..."})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 md:mb-0",children:"Donation Management"}),e.jsxs("div",{className:"bg-orange-100 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-orange-800",children:"Total Donations"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[e.jsx(f,{className:"inline-block mr-1"}),N.toLocaleString()]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m,onChange:C,placeholder:"Search by name, email, phone...",className:"w-full border border-gray-300 rounded-md pl-10 pr-3 py-2"}),e.jsx(B,{className:"absolute left-3 top-3 text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Date Range"}),e.jsxs("select",{value:c,onChange:F,className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"}),e.jsx("option",{value:"year",children:"Last Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:o,onChange:L,className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[e.jsx("option",{value:"date-desc",children:"Date (Newest First)"}),e.jsx("option",{value:"date-asc",children:"Date (Oldest First)"}),e.jsx("option",{value:"amount-desc",children:"Amount (Highest First)"}),e.jsx("option",{value:"amount-asc",children:"Amount (Lowest First)"})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:k,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md flex items-center",children:[e.jsx(q,{className:"mr-2"})," Export to CSV"]})})]}),x.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No donations found matching your criteria."})}):e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Donor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Purpose"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Method"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"flex flex-col text-sm text-gray-500",children:[t.email&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(z,{className:"mr-1",size:12}),t.email]}),t.phone&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(O,{className:"mr-1",size:12}),t.phone]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-green-600 font-medium flex items-center",children:[e.jsx(f,{className:"mr-1"}),Number(t.amount).toLocaleString()]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"capitalize",children:t.purpose||"General"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"capitalize",children:t.paymentMethod||"N/A"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2 text-gray-400"}),j(t.timestamp)]})})]},t.id))})]})})})]})};export{V as default};
